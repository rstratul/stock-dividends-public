generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  baseCurrency String    @default("USD")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  holdings     Holding[]
}

model Asset {
  id          String       @id @default(cuid())
  ticker      String       @unique
  symbol      String
  exchange    String
  name        String
  sector      String?
  currency    String
  lastPrice   Decimal?     @db.Decimal(18, 6)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  holdings    Holding[]
  dividends   Dividend[]
  financials  Financial[]

  @@index([exchange])
}

model Holding {
  id            String   @id @default(cuid())
  userId        String
  assetId       String
  quantity      Decimal  @db.Decimal(20, 6)
  averageBuyPrice Decimal @db.Decimal(18, 6)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([userId, assetId])
}

model Dividend {
  id         String   @id @default(cuid())
  assetId    String
  exDate     DateTime
  recordDate DateTime?
  payDate    DateTime
  amount     Decimal  @db.Decimal(18, 6)
  currency   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId, exDate])
}

model Financial {
  id           String   @id @default(cuid())
  assetId      String
  periodEnd    DateTime
  eps          Decimal? @db.Decimal(18, 6)
  netIncome    Decimal? @db.Decimal(20, 6)
  freeCashFlow Decimal? @db.Decimal(20, 6)
  currency     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([assetId, periodEnd])
}
